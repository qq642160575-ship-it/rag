### æ„å›¾åˆ†æ Intent Analysis

åœ¨ç”Ÿäº§çº§ RAG æ¶æ„ä¸­ï¼Œ**æ„å›¾åˆ†æï¼ˆIntent Analysisï¼‰** ä¸ä»…ä»…æ˜¯åˆ†ç±»ï¼Œæ›´æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œå¯¼èˆªä»ªâ€ä¸â€œé¢„å¤„ç†å™¨â€ã€‚ä¸€ä¸ªå®Œå–„çš„æ„å›¾åˆ†æèŠ‚ç‚¹åº”æ¶µç›–ä»¥ä¸‹ **å››å¤§æ ¸å¿ƒç»´åº¦**ï¼š

---

#### 1ï¸âƒ£ ä»»åŠ¡è·¯å¾„åˆ’åˆ† (Task Routing)

> [!IMPORTANT]
> **ç›®æ ‡**ï¼šå†³å®š Graph æ¥ä¸‹æ¥çš„æµè½¬æ–¹å‘ï¼Œå®ç°èµ„æºçš„æœ€ä¼˜é…ç½®ã€‚

* **åˆ†æé‡ç‚¹**ï¼šè¯†åˆ«ç”¨æˆ·è¯·æ±‚å±äºå“ªç§æ¨¡å¼ï¼š
  * **Searchï¼ˆæ£€ç´¢å‹ï¼‰**ï¼šéœ€è¦ç²¾å‡†æŸ¥æ‰¾ç‰¹å®šçŸ¥è¯†ç‚¹ã€‚
  * **Summaryï¼ˆæ€»ç»“å‹ï¼‰**ï¼šå¯¹æ•´ç¯‡æˆ–å¤šç¯‡æ–‡æ¡£è¿›è¡Œå…¨å±€æ¦‚æ‹¬ã€‚
  * **Compareï¼ˆå¯¹æ¯”å‹ï¼‰**ï¼šå¯¹ä¸¤ä¸ªæˆ–å¤šä¸ªä¸»ä½“è¿›è¡Œå·®å¼‚åŒ–åˆ†æã€‚
  * **Chitchatï¼ˆé—²èŠå‹ï¼‰**ï¼šæ— éœ€æ£€ç´¢ï¼Œç›´æ¥å›å¤ï¼ˆèŠ‚çœæˆæœ¬ä¸å»¶è¿Ÿï¼‰ã€‚
* **æ ¸å¿ƒä»·å€¼**ï¼šå†³å®šæ˜¯å¦å¼€å¯å¹¶è¡Œæ£€ç´¢æˆ–æ˜‚è´µçš„é•¿ä¸Šä¸‹æ–‡å¤„ç†æµç¨‹ã€‚

#### 2ï¸âƒ£ ç²¾å‡†å®ä½“ä¸å…³é”®è¯ (Entity & Keywords)

> [!TIP]
> **ç›®æ ‡**ï¼šæå– Query ä¸­çš„â€œç¡¬ä¿¡æ¯â€ï¼Œå¯¹æŠ—å‘é‡æ£€ç´¢çš„è¯­ä¹‰æ¨¡ç³Šã€‚

* **åˆ†æé‡ç‚¹**ï¼šä¸“æœ‰åè¯ï¼ˆäº§å“åã€åº“åï¼‰ã€ç‰ˆæœ¬å·ã€æ—¥æœŸã€ç‰¹å®š IDã€‚
* **æ ¸å¿ƒä»·å€¼**ï¼š
  * **é”šå®šæ£€ç´¢**ï¼šåœ¨ç”Ÿæˆçš„æ‰©å±•æŸ¥è¯¢ï¼ˆMulti-Queryï¼‰ä¸­å¼ºåˆ¶åŒ…å«è¿™äº›å®ä½“ã€‚
  * **å…³è”å¢å¼º**ï¼šåœ¨é‡æ’ï¼ˆRerankï¼‰é˜¶æ®µä½œä¸ºæ ¸å¿ƒå¾—åˆ†æƒé‡ã€‚

#### 3ï¸âƒ£ éšå«æŸ¥è¯¢æ”¹å†™ (Contextual Rewriting)

> [!NOTE]
> **ç›®æ ‡**ï¼šå°†ä¸å®Œæ•´çš„ç”¨æˆ·å£è¯­è½¬åŒ–ä¸ºæ ‡å‡†çš„æœºå™¨æ£€ç´¢è¯ã€‚

* **åˆ†æé‡ç‚¹**ï¼š
  * **æŒ‡ä»£æ¶ˆè§£**ï¼šå°†â€œå®ƒçš„åŸç†â€è¡¥å…¨ä¸ºâ€œRAG çš„åŸç†â€ã€‚
  * **å»å™ªå¤„ç†**ï¼šå‰”é™¤â€œè¯·é—®â€ã€â€œå¸®æˆ‘æœä¸€ä¸‹â€ç­‰æ— æ„ä¹‰çš„ä¿®é¥°è¯ã€‚
* **æ ¸å¿ƒä»·å€¼**ï¼šç”Ÿæˆæœ€çº¯ç²¹ã€å™ªå£°æœ€ä½çš„ **`refined_query`**ï¼Œæé«˜ç›¸ä¼¼åº¦è®¡ç®—çš„å‡†ç¡®æ€§ã€‚

#### 4ï¸âƒ£ å…ƒæ•°æ®é™åˆ¶æ¡ä»¶ (Constraint Extraction)

> [!CAUTION]
> **ç›®æ ‡**ï¼šæ•æ‰ç”¨æˆ·éšå«æˆ–æ˜¾å¼çš„é€»è¾‘åæ ‡ï¼Œè§¦å‘æœ€å¼ºåŠ²çš„â€œç¡¬è¿‡æ»¤â€ã€‚

* **åˆ†æé‡ç‚¹**ï¼š
  * **æ—¶é—´/èŒƒå›´**ï¼šå¦‚â€œ2023 å¹´ä»¥åçš„â€ã€â€œä»…é™ PDF æ¥æºâ€ã€‚
  * **é‡åŒ–è¦æ±‚**ï¼šå¦‚â€œæœ€ç›¸å…³çš„ 3 æ¡â€ã€‚
* **æ ¸å¿ƒä»·å€¼**ï¼šè®¾ç½®ç»“æ„åŒ–çš„ `filters` å­—å…¸ï¼Œè§¦å‘æ•°æ®åº“çš„ **Metadata Filtering** æµç¨‹ï¼Œç›´æ¥åœ¨ç´¢å¼•å±‚æ’é™¤å¹²æ‰°æ•°æ®ã€‚

---

### ğŸ’¡ æ¨èçš„ Pydantic æ¨¡å‹å®šä¹‰

```python
from typing import List, Dict, Any, Optional, Literal
from pydantic import BaseModel

class IntentOutput(BaseModel):
    # [è·¯ç”±] èµ°å“ªæ¡åˆ†æ”¯
    task_type: Literal['search', 'summary', 'compare', 'chitchat']
    
    # [å®ä½“] å“ªäº›æ˜¯æ ¸å¿ƒç¡¬è¯
    entities: List[str] 
    
    # [åæ ‡] ç”¨äºæ•°æ®åº“ç¡¬è¿‡æ»¤ (Metadata Filter)
    filters: Optional[Dict[str, Any]] = None  # ä¾‹å¦‚ {"year": 2023, "source": "rag_paper.pdf"}
    
    # [æ”¹å†™] æŠ›å»åºŸè¯åçš„çº¯ç²¹æ£€ç´¢è¯
    refined_query: str 
    
    # [é€»è¾‘] ä¸ºä»€ä¹ˆè¿™ä¹ˆåˆ¤æ–­ï¼ˆç”¨äºç³»ç»Ÿç›‘æ§ä¸ä¼˜åŒ– / æ€ç»´é“¾ï¼‰
    reason: str 
```

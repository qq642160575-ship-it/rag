import json
import os

notebook_path = r'c:\Users\64216\PycharmProjects\ç”Ÿäº§çº§rag\å¼€å‘ç»éªŒ&çŸ¥è¯†æ‰©å±•\ç”Ÿäº§çº§åˆ«çš„ragæµç¨‹.ipynb'

with open(notebook_path, 'r', encoding='utf-8') as f:
    nb = json.load(f)

new_content = [
    "### æ„å›¾åˆ†æ Intent Analysis\n",
    "\n",
    "åœ¨ç”Ÿäº§çº§ RAG æ¶æ„ä¸­ï¼Œ**æ„å›¾åˆ†æï¼ˆIntent Analysisï¼‰** ä¸ä»…ä»…æ˜¯åˆ†ç±»ï¼Œæ›´æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œå¯¼èˆªä»ªâ€ä¸â€œé¢„å¤„ç†å™¨â€ã€‚ä¸€ä¸ªå®Œå–„çš„æ„å›¾åˆ†æèŠ‚ç‚¹åº”æ¶µç›–ä»¥ä¸‹ **å››å¤§æ ¸å¿ƒç»´åº¦**ï¼š\n",
    "\n",
    "---\n",
    "\n",
    "#### 1ï¸âƒ£ ä»»åŠ¡è·¯å¾„åˆ’åˆ† (Task Routing)\n",
    "\n",
    "> **ç›®æ ‡**ï¼šå†³å®š Graph æ¥ä¸‹æ¥çš„æµè½¬æ–¹å‘ï¼Œå®ç°èµ„æºçš„æœ€ä¼˜é…ç½®ã€‚\n",
    "\n",
    "*   **åˆ†æé‡ç‚¹**ï¼šè¯†åˆ«ç”¨æˆ·è¯·æ±‚å±äºå“ªç§æ¨¡å¼ï¼š\n",
    "    *   **Searchï¼ˆæ£€ç´¢å‹ï¼‰**ï¼šéœ€è¦ç²¾å‡†æŸ¥æ‰¾ç‰¹å®šçŸ¥è¯†ç‚¹ã€‚\n",
    "    *   **Summaryï¼ˆæ€»ç»“å‹ï¼‰**ï¼šå¯¹æ•´ç¯‡æˆ–å¤šç¯‡æ–‡æ¡£è¿›è¡Œå…¨å±€æ¦‚æ‹¬ã€‚\n",
    "    *   **Compareï¼ˆå¯¹æ¯”å‹ï¼‰**ï¼šå¯¹ä¸¤ä¸ªæˆ–å¤šä¸ªä¸»ä½“è¿›è¡Œå·®å¼‚åŒ–åˆ†æã€‚\n",
    "    *   **Chitchatï¼ˆé—²èŠå‹ï¼‰**ï¼šæ— éœ€æ£€ç´¢ï¼Œç›´æ¥å›å¤ï¼ˆèŠ‚çœæˆæœ¬ä¸å»¶è¿Ÿï¼‰ã€‚\n",
    "*   **æ ¸å¿ƒä»·å€¼**ï¼šå†³å®šæ˜¯å¦å¼€å¯å¹¶è¡Œæ£€ç´¢æˆ–æ˜‚è´µçš„é•¿ä¸Šä¸‹æ–‡å¤„ç†æµç¨‹ã€‚\n",
    "\n",
    "#### 2ï¸âƒ£ ç²¾å‡†å®ä½“ä¸å…³é”®è¯ (Entity & Keywords)\n",
    "\n",
    "> **ç›®æ ‡**ï¼šæå– Query ä¸­çš„â€œç¡¬ä¿¡æ¯â€ï¼Œå¯¹æŠ—å‘é‡æ£€ç´¢çš„è¯­ä¹‰æ¨¡ç³Šã€‚\n",
    "\n",
    "*   **åˆ†æé‡ç‚¹**ï¼šä¸“æœ‰åè¯ï¼ˆäº§å“åã€åº“åï¼‰ã€ç‰ˆæœ¬å·ã€æ—¥æœŸã€ç‰¹å®š IDã€‚\n",
    "*   **æ ¸å¿ƒä»·å€¼**ï¼š\n",
    "    *   **é”šå®šæ£€ç´¢**ï¼šåœ¨ç”Ÿæˆçš„æ‰©å±•æŸ¥è¯¢ï¼ˆMulti-Queryï¼‰ä¸­å¼ºåˆ¶åŒ…å«è¿™äº›å®ä½“ã€‚\n",
    "    *   **å…³è”å¢å¼º**ï¼šåœ¨é‡æ’ï¼ˆRerankï¼‰é˜¶æ®µä½œä¸ºæ ¸å¿ƒå¾—åˆ†æƒé‡ã€‚\n",
    "\n",
    "#### 3ï¸âƒ£ éšå«æŸ¥è¯¢æ”¹å†™ (Contextual Rewriting)\n",
    "\n",
    "> **ç›®æ ‡**ï¼šå°†ä¸å®Œæ•´çš„ç”¨æˆ·å£è¯­è½¬åŒ–ä¸ºæ ‡å‡†çš„æœºå™¨æ£€ç´¢è¯ã€‚\n",
    "\n",
    "*   **åˆ†æé‡ç‚¹**ï¼š\n",
    "    *   **æŒ‡ä»£æ¶ˆè§£**ï¼šå°†â€œå®ƒçš„åŸç†â€è¡¥å…¨ä¸ºâ€œRAG çš„åŸç†â€ã€‚\n",
    "    *   **å»å™ªå¤„ç†**ï¼šå‰”é™¤â€œè¯·é—®â€ã€â€œå¸®æˆ‘æœä¸€ä¸‹â€ç­‰æ— æ„ä¹‰çš„ä¿®é¥°è¯ã€‚\n",
    "*   **æ ¸å¿ƒä»·å€¼**ï¼šç”Ÿæˆæœ€çº¯ç²¹ã€å™ªå£°æœ€ä½çš„ **`refined_query`**ï¼Œæé«˜ç›¸ä¼¼åº¦è®¡ç®—çš„å‡†ç¡®æ€§ã€‚\n",
    "\n",
    "#### 4ï¸âƒ£ å…ƒæ•°æ®é™åˆ¶æ¡ä»¶ (Constraint Extraction)\n",
    "\n",
    "> **ç›®æ ‡**ï¼šæ•æ‰ç”¨æˆ·éšå«æˆ–æ˜¾å¼çš„é€»è¾‘åæ ‡ï¼Œè§¦å‘æœ€å¼ºåŠ²çš„â€œç¡¬è¿‡æ»¤â€ã€‚\n",
    "\n",
    "*   **åˆ†æé‡ç‚¹**ï¼š\n",
    "    *   **æ—¶é—´/èŒƒå›´**ï¼šå¦‚â€œ2023 å¹´ä»¥åçš„â€ã€â€œä»…é™ PDF æ¥æºâ€ã€‚\n",
    "    *   **é‡åŒ–è¦æ±‚**ï¼šå¦‚â€œæœ€ç›¸å…³çš„ 3 æ¡â€ã€‚\n",
    "*   **æ ¸å¿ƒä»·å€¼**ï¼šè®¾ç½®ç»“æ„åŒ–çš„ `filters` å­—å…¸ï¼Œè§¦å‘æ•°æ®åº“çš„ **Metadata Filtering** æµç¨‹ï¼Œç›´æ¥åœ¨ç´¢å¼•å±‚æ’é™¤å¹²æ‰°æ•°æ®ã€‚\n",
    "\n",
    "---\n",
    "\n",
    "#### ğŸ’¡ æ¨èçš„ Pydantic æ¨¡å‹å®šä¹‰\n",
    "\n",
    "```python\n",
    "from typing import List, Dict, Any, Optional, Literal\n",
    "from pydantic import BaseModel\n",
    "\n",
    "class IntentOutput(BaseModel):\n",
    "    # [è·¯ç”±] èµ°å“ªæ¡åˆ†æ”¯\n",
    "    task_type: Literal['search', 'summary', 'compare', 'chitchat']\n",
    "    \n",
    "    # [å®ä½“] å“ªäº›æ˜¯æ ¸å¿ƒç¡¬è¯\n",
    "    entities: List[str] \n",
    "    \n",
    "    # [åæ ‡] ç”¨äºæ•°æ®åº“ç¡¬è¿‡æ»¤ (Metadata Filter)\n",
    "    filters: Optional[Dict[str, Any]] = None  # ä¾‹å¦‚ {\"year\": 2023, \"source\": \"rag_paper.pdf\"}\n",
    "    \n",
    "    # [æ”¹å†™] æŠ›å»åºŸè¯åçš„çº¯ç²¹æ£€ç´¢è¯\n",
    "    refined_query: str \n",
    "    \n",
    "    # [é€»è¾‘] ä¸ºä»€ä¹ˆè¿™ä¹ˆåˆ¤æ–­ï¼ˆç”¨äºç³»ç»Ÿç›‘æ§ä¸ä¼˜åŒ– / æ€ç»´é“¾ï¼‰\n",
    "    reason: str \n",
    "```"
]

# Find the cell to replace
# Looking for the cell that starts with "### æ„å›¾åˆ†æ Intent Analysis"
updated = False
for cell in nb['cells']:
    if cell['cell_type'] == 'markdown' and len(cell['source']) > 0:
        if "### æ„å›¾åˆ†æ Intent Analysis" in cell['source'][0]:
            cell['source'] = new_content
            updated = True
            break

if updated:
    with open(notebook_path, 'w', encoding='utf-8') as f:
        json.dump(nb, f, ensure_ascii=False, indent=1)
    print("Notebook updated successfully.")
else:
    print("Target cell not found.")
